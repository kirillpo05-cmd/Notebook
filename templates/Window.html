<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Help</title>
  <link rel="stylesheet" href="css/style.css" />
  <script>
    // Текущее открытое окно (если есть) — закрываем его перед открытием нового
    let currentWindow = null;

    // Универсальная функция открытия окна — закрывает предыдущую
    function openWindow(name, content, width = 400, height = 400) {
      if (currentWindow && !currentWindow.closed) {
        try { currentWindow.close(); } catch (e) { /* ignore */ }
      }
      currentWindow = window.open("", name, `width=${width},height=${height}`);
      currentWindow.document.write(content);
      currentWindow.document.close();
      try { currentWindow.focus(); } catch (e) {}
    }

    // Открыть окно регистрации
    function openRegisterWindow() {
      openWindow("Register", `
        <!doctype html>
        <html lang="en">
        <head>
          <meta charset="utf-8">
          <title>Registration</title>
          <meta name="viewport" content="width=device-width,initial-scale=1">
          <link rel="stylesheet" href="css/style.css">
          <style>
            body{font-family:Arial,sans-serif;padding:20px}
            form{display:flex;flex-direction:column;gap:10px}
            input{padding:8px;border-radius:5px;border:1px solid #ccc}
            button{padding:10px;border-radius:5px;border:none;cursor:pointer}
          </style>
        </head>
        <body>
          <h2>Registration</h2>
          <form onsubmit="return false">
            <input type="text" placeholder="Login" required>
            <input type="email" placeholder="Email" required>
            <input type="password" placeholder="Password" required>
            <button type="button">Sign up</button>
          </form>
        </body>
        </html>
      `);
    }

    // Открыть окно логина — кнопка "Forget password?" отправляет сообщение родителю
    function openLoginWindow() {
      openWindow("Login", `
        <!doctype html>
        <html lang="en">
        <head>
          <meta charset="utf-8">
          <title>Log In</title>
          <meta name="viewport" content="width=device-width,initial-scale=1">
          <link rel="stylesheet" href="css/style.css">
          <style>
            body{font-family:Arial,sans-serif;padding:20px}
            form{display:flex;flex-direction:column;gap:10px}
            input{padding:8px;border-radius:5px;border:1px solid #ccc}
            button{padding:10px;border-radius:5px;border:none;cursor:pointer}
          </style>
        </head>
        <body>
          <h2>Log In</h2>
          <form onsubmit="return false">
            <input type="text" placeholder="Login" required>
            <input type="password" placeholder="Password" required>
            <div style="display:flex;gap:8px">
              <button type="button">Log in</button>
              <!-- Вместо вызова функций родителя — отправляем postMessage -->
              <button type="button" onclick="window.opener && window.opener.postMessage({ action: 'openForget' }, '*')">Forget password?</button>
            </div>
          </form>
        </body>
        </html>
      `);
    }

    // Обработчик сообщений от дочерних окон
    window.addEventListener('message', function (event) {
      // Ограничение: примем сообщение только если оно пришло от нашего текущего окна
      if (!currentWindow) return;
      if (event.source !== currentWindow) return;

      const data = event.data || {};
      if (data.action === 'openForget') {
        openForgetFromParent();
      } else if (data.action === 'openEmail') {
        openEmailFromParent();
      }
    });

    // Функция открывает окно "Forget" (вызывается из обработчика сообщений)
    function openForgetFromParent() {
      openWindow("Forget", `
        <!doctype html>
        <html lang="en">
        <head>
          <meta charset="utf-8">
          <title>Forget password</title>
          <meta name="viewport" content="width=device-width,initial-scale=1">
          <link rel="stylesheet" href="css/style.css">
          <style>
            body{font-family:Arial,sans-serif;padding:20px}
            form{display:flex;flex-direction:column;gap:10px}
            input{padding:8px;border-radius:5px;border:1px solid #ccc}
            button{padding:10px;border-radius:5px;border:none;cursor:pointer}
          </style>
        </head>
        <body>
          <h2>Forget password</h2>
          <form onsubmit="return false">
            <p>Enter email to reset password:</p>
            <input type="email" placeholder="Email" required>
            <!-- вместо вызова opener функции — отправляем команду родителю -->
            <button type="button" onclick="window.opener && window.opener.postMessage({ action: 'openEmail' }, '*')">Submit</button>
          </form>
        </body>
        </html>
      `);
    }

    // Функция открывает окно для смены пароля
    function openEmailFromParent() {
      openWindow("ChangePassword", `
        <!doctype html>
        <html lang="en">
        <head>
          <meta charset="utf-8">
          <title>Change password</title>
          <meta name="viewport" content="width=device-width,initial-scale=1">
          <link rel="stylesheet" href="css/style.css">
          <style>
            body{font-family:Arial,sans-serif;padding:20px}
            form{display:flex;flex-direction:column;gap:10px}
            input{padding:8px;border-radius:5px;border:1px solid #ccc}
            button{padding:10px;border-radius:5px;border:none;cursor:pointer}
          </style>
        </head>
        <body>
          <h2>Change Password</h2>
          <form onsubmit="return false">
            <input type="password" placeholder="New Password" required>
            <input type="password" placeholder="Confirm Password" required>
            <button type="button">Submit</button>
          </form>
        </body>
        </html>
      `);
    }
  </script>
</head>
<link href="https://fonts.googleapis.com/css2?family=Averia+Sans+Libre&display=swap" rel="stylesheet">
<body>
<h1>Notevaky</h1>
<button onclick="window.close()">Close</button>

<div class="button-window">
  <button class="button1" onclick="openRegisterWindow()">Sign In</button>
  <button class="button1" onclick="openLoginWindow()">Log In</button>
</div>
<p></p>
</body>
</html>